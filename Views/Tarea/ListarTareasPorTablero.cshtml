@using Kanban
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@{
    int idUsuario = HttpContextAccessor.HttpContext.Session.GetInt32("Id").Value;
}

@model List<Kanban.ViewModels.ListarTareasViewModel>

@{
    ViewData["Title"] = "Tareas del Tablero " + ViewData["NombreTablero"];
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger" role="alert">
        @TempData["ErrorMessage"]
    </div>
}

<h1 class="text-center">Tareas del Tablero @ViewData["NombreTablero"]</h1>

@functions {
    string ObtenerNombreEstado(int estado)
    {
        return estado switch
        {
            1 => "Ideas",
            2 => "ToDo",
            3 => "Doing",
            4 => "Review",
            5 => "Done",
            _ => "Desconocido"
        };
    }
}

<div class="container-fluid">
    <div class="row d-flex justify-content-around">
        <!-- üß† Ideas -->
        <div class="col-12 col-md-2 d-flex flex-column">
            <h4 class="text-center bg-secondary text-white p-2">üß† Ideas</h4>
            <div class="kanban-column flex-grow-1">
                @foreach (var tarea in Model.Where(t => t.Estado == EstadoTarea.Ideas))
                {
                    <partial name="_TareaCard" model="tarea" view-data='@ViewData'/>
                }
            </div>
        </div>

        <!-- üìù To Do -->
        <div class="col-12 col-md-2 d-flex flex-column">
            <h4 class="text-center bg-light text-dark p-2">üìù To Do</h4>
            <div class="kanban-column flex-grow-1">
                @foreach (var tarea in Model.Where(t => t.Estado == EstadoTarea.ToDo))
                {
                    <partial name="_TareaCard" model="tarea" view-data='@ViewData'/>
                }
            </div>
        </div>

        <!-- üöÄ Doing -->
        <div class="col-12 col-md-2 d-flex flex-column">
            <h4 class="text-center bg-primary text-white p-2">üöÄ Doing</h4>
            <div class="kanban-column flex-grow-1">
                @foreach (var tarea in Model.Where(t => t.Estado == EstadoTarea.Doing))
                {
                    <partial name="_TareaCard" model="tarea" view-data='@ViewData'/>
                }
            </div>
        </div>

        <!-- üîç Review -->
        <div class="col-12 col-md-2 d-flex flex-column">
            <h4 class="text-center bg-warning text-dark p-2">üîç Review</h4>
            <div class="kanban-column flex-grow-1">
                @foreach (var tarea in Model.Where(t => t.Estado == EstadoTarea.Review))
                {
                    <partial name="_TareaCard" model="tarea" view-data='@ViewData'/>
                }
            </div>
        </div>

        <!-- ‚úÖ Done -->
        <div class="col-12 col-md-2 d-flex flex-column">
            <h4 class="text-center bg-success text-white p-2">‚úÖ Done</h4>
            <div class="kanban-column flex-grow-1">
                @foreach (var tarea in Model.Where(t => t.Estado == EstadoTarea.Done))
                {
                    <partial name="_TareaCard" model="tarea" view-data='@ViewData' />
                }
            </div>
        </div>
    </div>
</div>

<div class="text-center mt-4">
    <a asp-controller="Tablero" asp-action="Listar" class="btn btn-secondary">Volver a Tableros</a>
    <a asp-controller="Tarea" asp-action="CrearTarea" class="btn btn-success" asp-route-idTablero="@ViewData["IdTablero"]">Agregar Tarea</a>
</div>

@section Styles {
    <style>
        .kanban-column {
            min-height: 300px;
            padding: 10px;
            background-color: rgba(240, 240, 240, 0.8);
            border-radius: 8px;
            overflow-y: auto; /* Agrega scroll si hay muchas tareas */
        
        }
        .card-title {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .dark-theme .bg-light {
            background-color: #4b4b4b !important;
            color: #ffffff !important;
        }
    </style>
}